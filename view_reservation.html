<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>View Reservations</title>
<style>
body { 
    font-family: 'Poppins', sans-serif; 
    background: #f8fbff; 
    padding: 40px; 
}
h2 { 
    text-align: center; 
    color: #333; 
    margin-bottom: 30px; 
}
table {
    width: 85%;
    margin: auto;
    border-collapse: collapse;
    background: white;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border-radius: 8px;
    overflow: hidden;
}
th, td {
    padding: 12px;
    border: 1px solid #ddd;
    text-align: center;
}
th { 
    background: #007bff; 
    color: white; 
}
tr:hover { 
    background: #f1f1f1; 
}
.no-data {
    text-align: center;
    font-style: italic;
    color: #666;
}
.delete {
    background: #dc3545;
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 600;
    cursor: pointer;
}
</style>
</head>
<body>

<h2>All Reservations</h2>

<table id="reservationTable">
<tr>
    <th>Reservation ID</th>
    <th>User ID</th>
    <th>Book ID</th>
    <th>Date</th>
    <th>Action</th>
</tr>
</table>

<script>
  // Fetch reservations from backend
  fetch("http://localhost:5000/api/admin/reservations", {
    headers: { Authorization: "Bearer " + localStorage.getItem("token") }
  })
  .then(res => res.json())
  .then(reservations => {
    console.log(reservations); // Debug log
    const table = document.getElementById("reservationTable");

    if(reservations.length === 0){
      table.innerHTML += '<tr><td colspan="5" class="no-data">No reservations found</td></tr>';
      return;
    }

    reservations.forEach(r => {
      let row = `
        <tr>
          <td>${r._id}</td>
          <td>${r.userId}</td>
          <td>${r.bookId}</td>
          <td>${new Date(r.date).toLocaleDateString()}</td>
          <td><button class="delete" onclick="deleteReservation('${r._id}', this)">Delete</button></td>
        </tr>
      `;
      table.innerHTML += row;
    });
  })
  .catch(err => console.error("Error loading reservations:", err));

  // Delete reservation
  function deleteReservation(id, btn) {
    if (!confirm("Are you sure you want to delete this reservation?")) return;

    fetch(`http://localhost:5000/api/admin/reservations/${id}`, {
      method: "DELETE",
      headers: { Authorization: "Bearer " + localStorage.getItem("token") }
    })
    .then(res => res.json())
    .then(() => {
      alert("Reservation deleted");
      btn.closest("tr").remove(); // Remove row dynamically
    })
    .catch(err => console.error("Delete error:", err));
  }
</script>

</body>
</html>
