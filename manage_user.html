<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manage Users</title>
<style>
  body { 
    font-family: 'Poppins', sans-serif; 
    background: #f8fbff; 
    padding: 40px; 
  }
  h2 { 
    text-align: center; 
    color: #333; 
    margin-bottom: 30px; 
  }
  table {
    width: 80%;
    margin: auto;
    border-collapse: collapse;
    background: white;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
  th, td {
    padding: 12px;
    border: 1px solid #ddd;
    text-align: center;
  }
  th { 
    background: #007bff; 
    color: white; 
  }
  tr:hover { background: #f1f1f1; }
  .delete {
    background: #dc3545;
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 600;
    cursor: pointer;
  }
</style>
</head>
<body>

<h2>Manage Users</h2>

<table id="userTable">
  <tr>
    <th>ID</th>
    <th>Username</th>
    <th>Email</th>
    <th>Role</th>
    <th>Action</th>
  </tr>
</table>

<script>
  // Fetch users from backend
  fetch("http://localhost:5000/api/admin/users", {
    headers: { Authorization: "Bearer " + localStorage.getItem("token") }
  })
  .then(res => res.json())
  .then(users => {
    console.log(users); // Logs all users for debugging
    const table = document.getElementById("userTable");

    if(users.length === 0){
      table.innerHTML += '<tr><td colspan="5" class="no-data">No users found</td></tr>';
      return;
    }

    users.forEach(user => {
      let row = `
        <tr>
          <td>${user._id}</td>
          <td>${user.name}</td>
          <td>${user.email}</td>
          <td>${user.role || "Member"}</td>
          <td><button class="delete" onclick="deleteUser('${user._id}', this)">Delete</button></td>
        </tr>
      `;
      table.innerHTML += row;
    });
  })
  .catch(err => console.error("Error loading users:", err));

  // Delete User Function
  function deleteUser(id, btn) {
    if (!confirm("Are you sure you want to delete this user?")) return;

    fetch(`http://localhost:5000/api/admin/users/${id}`, {
      method: "DELETE",
      headers: { Authorization: "Bearer " + localStorage.getItem("token") }
    })
    .then(res => res.json())
    .then(data => {
      alert("User Deleted");
      btn.closest("tr").remove(); // Remove the deleted row without page reload
    })
    .catch(err => console.error("Delete error:", err));
  }
</script>

</body>
</html>

